<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å…¥ / è¨»å†Š - Treat Trader</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .login-container {
            height: 100%;
        }
        
        /* å½ˆçª—æ¨£å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div class="marquee-container">âœ¨ æ­¡æ…¶é–‹å¹•ï¼šä¸‹å–®æ»¿é¡ç«‹å³å…é‹ï¼Œé…é€åˆ°å®¶è¶…ä¾¿åˆ© ğŸ“¦</div>
    
    <header>
        <div class="logo" onclick="location.href='index.html'">
            <img src="images/Logo.PNG" alt="Logo">
            Treat Trader
        </div>

        <nav class="main-nav">
            <a href="index.html">é¦–é </a>
            <a href="allgoods.html">å•†å“ç¸½è¦½</a>
            <a href="member.html">æœƒå“¡è³‡æ–™</a>
            <a href="team.html">é—œæ–¼æˆ‘å€‘</a>
        </nav>

        <div class="header-icons">
            <a href="cart.html"><i class="fa-solid fa-cart-shopping"></i></a>
            <a href="login.html" id="avatarLink"><i class="fa-solid fa-circle-user"></i></a>
        </div>
    </header>

    <div class="container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
        <div class="card login-container">
            <h2>æœƒå“¡ç™»å…¥</h2>
            <form style="margin-top: 20px;" onsubmit="handleLogin(event)">
                <input type="email" id="loginEmail" placeholder="å¸³è™Ÿ (Email)" required style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">
                <input type="password" id="loginPwd" placeholder="å¯†ç¢¼" required style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">
                <div style="text-align:right; margin-bottom:15px;">
                    <a href="#" onclick="showForgetModal()" style="color:#FF7F50; font-size:0.9rem;">å¿˜è¨˜å¯†ç¢¼ï¼Ÿ</a>
                </div>
                <button class="btn" style="width:100%; font-size:1.1rem;">ç™»å…¥</button>
            </form>
        </div>

        <div class="card login-container">
            <h2>æ–°æœƒå“¡è¨»å†Š</h2>
            <form style="margin-top: 20px;" onsubmit="handleRegister(event)">
                <input type="text" id="regName" placeholder="å§“å" required style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">
                <input type="tel" id="regPhone" placeholder="é›»è©±è™Ÿç¢¼" required style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">
                <input type="email" id="regEmail" placeholder="Email" required style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">
                <input type="password" id="regPwd" placeholder="å¯†ç¢¼" required style="width:100%; padding:12px; margin-bottom:15px; border:1px solid #ccc; border-radius:5px;">
                <button class="btn" style="width:100%; background:#5C4033; font-size:1.1rem;">è¨»å†Š</button>
            </form>
        </div>
    </div>

    <div id="forgetModal" class="modal-overlay">
        <div class="modal-box">
            <h3>æ‰¾å›å¯†ç¢¼</h3>
            <p style="margin:10px 0;">è«‹è¼¸å…¥æ‚¨çš„ Email èˆ‡é›»è©±ã€‚</p>
            <input type="email" id="forgetEmail" placeholder="Email" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;">
            <input type="tel" id="forgetPhone" placeholder="é›»è©±è™Ÿç¢¼" style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ddd; border-radius:5px;">
            <button class="btn" onclick="confirmForget()">ç¢ºèª</button>
            <button class="btn" style="background:#aaa; margin-left:10px;" onclick="closeForgetModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="scroll-top" onclick="window.scrollTo(0,0)">TOP</div>

    <footer>
        <div class="footer-socials">
            <a href="https://reurl.cc/xKA8ae" target="_blank">
                <i class="fa-brands fa-instagram"></i></a>
            <a href="https://reurl.cc/Vmlo9A" target="_blank">
                <i class="fa-brands fa-threads"></i></a>
            <a href="https://reurl.cc/9ba94j" target="_blank">
                <i class="fa-brands fa-line"></i></a>
            <a href="mailto:service@example.com">
                <i class="fa-solid fa-envelope"></i></a>
        </div>
        <div class="footer-links"><a href="help.html">å¹«åŠ©ä¸­å¿ƒ</a> | <a href="question.html">å¸¸è¦‹å•é¡Œ</a></div>
        <p class="copyright">Â© COPYRIGHT 807dorm</p>
    </footer>

    <script>
    const API_BASE = "http://localhost:5038/api";

    window.onload = function () {
        var user = JSON.parse(localStorage.getItem('tt_currentUser'));
        if (user) document.getElementById('avatarLink').href = "member.html";
    };

    // è¨»å†Š
    function handleRegister(e) {
        e.preventDefault();

        var name = document.getElementById('regName').value.trim();
        var phone = document.getElementById('regPhone').value.trim();
        var email = document.getElementById('regEmail').value.trim();
        var pwd = document.getElementById('regPwd').value;

        if (!name || !email || !pwd) {
            alert("è«‹å®Œæ•´å¡«å¯«å¿…å¡«æ¬„ä½");
            return;
        }

        fetch(API_BASE + "/Auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                name: name,
                email: email,
                password: pwd,
                phone: phone,
                address: null
            })
        })
        .then(function (res) {
            if (!res.ok) return res.json().then(function (err) { throw err; });
            return res.json();
        })
        .then(function (user) {
            // è¨»å†ŠæˆåŠŸå¾Œï¼Œç›´æ¥è¦–ç‚ºå·²ç™»å…¥ï¼Œå­˜åœ¨ localStorage
            localStorage.setItem("tt_currentUser", JSON.stringify(user));
            alert("è¨»å†ŠæˆåŠŸï¼");
            location.href = "member.html";
        })
        .catch(function (err) {
            alert(err.message || "è¨»å†Šå¤±æ•—");
        });
    }

    // ç™»å…¥
    function handleLogin(e) {
        e.preventDefault();

        var email = document.getElementById('loginEmail').value.trim();
        var pwd = document.getElementById('loginPwd').value;

        if (!email || !pwd) {
            alert("è«‹è¼¸å…¥å¸³è™Ÿèˆ‡å¯†ç¢¼");
            return;
        }

        fetch(API_BASE + "/Auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: email,
                password: pwd
            })
        })
        .then(function (res) {
            if (!res.ok) return res.json().then(function (err) { throw err; });
            return res.json();
        })
        .then(function (user) {
            localStorage.setItem("tt_currentUser", JSON.stringify(user));
            alert("ç™»å…¥æˆåŠŸï¼");
            location.href = "member.html";
        })
        .catch(function (err) {
            alert(err.message || "ç™»å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªå¸³è™Ÿå¯†ç¢¼");
        });
    }

    // ä¸‹é¢åŸæœ¬å¿˜è¨˜å¯†ç¢¼çš„å½ˆçª—åŠŸèƒ½å¯ä»¥ä¿ç•™ä¸å‹•
    function showForgetModal() { document.getElementById('forgetModal').style.display = 'flex'; }
    function closeForgetModal() { document.getElementById('forgetModal').style.display = 'none'; }

    function confirmForget() {
        var email = document.getElementById('forgetEmail').value;
        var phone = document.getElementById('forgetPhone').value;
        if (!email || !phone) { alert("è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼"); return; }
        alert("é€™æ˜¯ demo ç¶²ç«™ï¼Œè«‹è¯çµ¡å®¢æœé‡è¨­å¯†ç¢¼ : )");
        closeForgetModal();
    }
    </script>

</body>
</html>