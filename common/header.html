<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cart2</title>
    <link rel="stylesheet" href="cart2.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="announcement">
        新年回饋祭最高 10% OFF ｜ 滿 $2500 免運
    </div>

    <header>
        <a href="index.html" class="logo">LOGO</a>
        <div class="search-bar">
            <input type="text" placeholder="搜尋商品...">
            <button class="search-btn">搜尋</button>
        </div>
        <div class="header-icons">
            <a href="cart.html" class="icon-link">購物車</a>
            <a href="login.html" class="icon-link">會員登入</a>
        </div>
    </header>

    <script>
        // 1. 數量增減與金額計算
        function updateQty(btn, change) {
            const qtySpan = btn.parentElement.querySelector('.qty-val');
            let qty = parseInt(qtySpan.innerText) + change;
            if (qty < 1) qty = 1;
            qtySpan.innerText = qty;
            calculateTotal();
        }

        // 2. 刪除商品
        function deleteItem(btn) {
            if (confirm("確定要移除此商品？")) {
                btn.closest('.cart-item').remove();
                calculateTotal();
            }
        }

        // 3. 計算總金額
        function calculateTotal() {
            let total = 0;
            document.querySelectorAll('.cart-item').forEach(item => {
                const price = parseInt(item.getAttribute('data-price'));
                const qty = parseInt(item.querySelector('.qty-val').innerText);
                total += price * qty;
            });
            
            document.getElementById('grand-total').innerText = total;
            // 同步更新結帳區金額
            const checkSub = document.getElementById('check-subtotal');
            if (checkSub) {
                checkSub.innerText = '$' + total;
                document.getElementById('check-final').innerText = total + 60;
            }
        }

        // 4. 前往結帳 / 回到購物車 切換
        function handleCheckoutStep() {
            const cartSide = document.getElementById('cart-side');
            const checkoutMain = document.getElementById('checkout-main');
            const toggleBtn = document.getElementById('checkout-toggle-btn');

            if (checkoutMain.style.display === "none") {
                // 進入結帳
                checkoutMain.style.display = "block";
                cartSide.classList.add('locked');
                toggleBtn.innerText = "回到購物車";
                window.scrollTo({ top: checkoutMain.offsetTop - 50, behavior: 'smooth' });
            } else {
                // 返回購物車
                checkoutMain.style.display = "none";
                cartSide.classList.remove('locked');
                toggleBtn.innerText = "前往結帳";
            }
        }

        // 5. 結帳區塊鎖定/解鎖
        function toggleLock(btn) {
            const section = btn.closest('.form-section');
            const inputs = section.querySelectorAll('input');
            
            if (section.classList.contains('is-locked')) {
                // 解鎖
                section.classList.remove('is-locked');
                inputs.forEach(i => i.disabled = false);
                btn.innerText = "確認";
            } else {
                // 鎖定
                section.classList.add('is-locked');
                inputs.forEach(i => i.disabled = true);
                btn.innerText = "取消確認";
            }
        }

        // 6. 選擇按鈕效果 (付款/發票)
        function selectType(btn) {
            const group = btn.parentElement;
            group.querySelectorAll('.selection-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // 7. 回到頂部
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>